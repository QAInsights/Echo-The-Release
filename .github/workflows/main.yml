name: CI
on: [push]

jobs:
  get-version:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.ECHO_TOKEN }}
    - name: Repo 1
      run: |
        echo "15" > Sample-Repo/echo.txt
        
    - name: Repo 2
      run: |
        echo "15" > Another-Sample-Repo/echo.txt
     
    - name: Check for modified files
      id: git-check
      run: | 
        git diff --name-only | xargs -L1 dirname | uniq > changes.txt
        echo $(wc -l changes.txt | awk '{print $1}')
        cat changes.txt | while read line;
          echo $line
          do
            #curl -XPOST -d '{"notification": "New release is now available for $line", "accessCode": "${{ secrets.ECHO_KEY }}", "title": "New Release"}' 'https://api.notifymyecho.com/v1/NotifyMe'
          done
        echo "" > changes.txt
      
    - name: Commit latest release version
      run: |
        git config --global user.name 'QAInsights'
        git config --global user.email 'catch.nkn@gmail.com'
        git commit -am "New release version"
        git push
