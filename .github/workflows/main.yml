name: CI
on: [push]

jobs:
  get-version:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.ECHO_TOKEN }}
    - name: Repo 1
      run: |
        curl -sL https://api.github.com/repos/QAInsights/Sample-Repo/releases/latest | \
        jq -r ".tag_name" > Sample-Repo/echo.txt
        echo "hello" > Sample-Repo/echo.txt
        
    - name: Repo 2
      run: |
        curl -sL https://api.github.com/repos/QAInsights/Another-Sample-Repo/releases/latest | \
        jq -r ".tag_name" > Sample-Repo/echo.txt
        echo "second repo" > Another-Sample-Repo/echo.txt
     
    - name: Check for modified files
      id: git-check
      run: | 
        echo ::set-output name=modified::$([ -z "`git status --porcelain`" ] && echo "false" || echo "true")
        git status --porcelain
      
    - name: Commit latest release version
      if: steps.git-check.outputs.modified == 'true'
      run: |
        git config --global user.name 'QAInsights'
        git config --global user.email 'catch.nkn@gmail.com'
        git commit -am "New release version"
        git push
